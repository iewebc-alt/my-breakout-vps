#!/bin/bash

# u.sh ‚Äî –ñ–µ—Å—Ç–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ (Manifest v2.3)
# –ü—É—Ç—å: /var/www/breakout_dev

echo "üßπ –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å—Ç–∞—Ä–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –∏ —É–¥–∞–ª–µ–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –æ–±—Ä–∞–∑–∞..."

# –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –ø–∞–ø–∫—É –ø—Ä–æ–µ–∫—Ç–∞
cd /var/www/breakout_dev || exit

# 1. –°–Ω–æ—Å–∏–º —Ç–µ–∫—É—â–∏–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏ –µ–≥–æ –æ–±—Ä–∞–∑, —á—Ç–æ–±—ã Docker –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª —Å—Ç–∞—Ä—ã–µ —Å–ª–æ–∏
docker compose down --rmi local

# 2. –°–æ–±–∏—Ä–∞–µ–º –Ω–æ–≤—ã–π –æ–±—Ä–∞–∑ –ü–†–ò–ù–£–î–ò–¢–ï–õ–¨–ù–û –ë–ï–ó –ö–≠–®–ê
# –≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ .js –º–æ–¥—É–ª—è—Ö –ø–æ–ø–∞–¥—É—Ç –≤ Nginx
echo "üèóÔ∏è  –°–±–æ—Ä–∫–∞ –Ω–æ–≤–æ–≥–æ –æ–±—Ä–∞–∑–∞ (--no-cache)..."
docker compose build --no-cache

# 3. –ó–∞–ø—É—Å–∫ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–π –≤–µ—Ä—Å–∏–∏ –≤ —Ñ–æ–Ω–µ
echo "üöÄ –ó–∞–ø—É—Å–∫..."
docker compose up -d

# 4. –û—á–∏—Å—Ç–∫–∞ "–≤–∏—Å—è—á–∏—Ö" —Å–ª–æ–µ–≤, —á—Ç–æ–±—ã —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –º–µ—Å—Ç–æ –Ω–∞ –¥–∏—Å–∫–µ (10–ì–ë –ª–∏–º–∏—Ç!)
echo "üóëÔ∏è  –£–¥–∞–ª–µ–Ω–∏–µ –º—É—Å–æ—Ä–Ω—ã—Ö —Å–ª–æ–µ–≤..."
docker image prune -f

echo "-------------------------------------------------------"
echo "‚úÖ DEV-–≤–µ—Ä—Å–∏—è —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∞!"
echo "üîó –ê–¥—Ä–µ—Å: https://dev.breakout-ball.mooo.com:444/"
echo "-------------------------------------------------------"
