#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –∂–µ—Å—Ç–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è DEV-–æ–∫—Ä—É–∂–µ–Ω–∏—è
# –ü—É—Ç—å: /var/www/breakout_dev

echo "üßπ –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –ø–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤..."

# –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –ø–∞–ø–∫—É –ø—Ä–æ–µ–∫—Ç–∞
cd /var/www/breakout_dev || exit

# 1. –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏ —É–¥–∞–ª—è–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã, —Å–µ—Ç–∏ –∏ –æ–±—Ä–∞–∑—ã, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å —ç—Ç–∏–º –ø—Ä–æ–µ–∫—Ç–æ–º
docker compose down --rmi local

# 2. –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è —Å–±–æ—Ä–∫–∞ –ë–ï–ó –ö–≠–®–ê
# –≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ Docker –∑–∞–Ω–æ–≤–æ —Å–∫–æ–ø–∏—Ä—É–µ—Ç –≤—Å–µ –º–æ–¥—É–ª–∏ (state.js, physics.js –∏ —Ç.–¥.)
echo "üèóÔ∏è  –°–±–æ—Ä–∫–∞ –Ω–æ–≤–æ–≥–æ –æ–±—Ä–∞–∑–∞ (no-cache)..."
docker compose build --no-cache

# 3. –ó–∞–ø—É—Å–∫ –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ
echo "üöÄ –ó–∞–ø—É—Å–∫ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–π –≤–µ—Ä—Å–∏–∏..."
docker compose up -d

# 4. –ì–ª—É–±–æ–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –º—É—Å–æ—Ä–∞
# –£–¥–∞–ª—è–µ–º –≤—Å–µ "–≤–∏—Å—è—á–∏–µ" (dangling) —Å–ª–æ–∏, –∫–æ—Ç–æ—Ä—ã–µ –æ—Å—Ç–∞–ª–∏—Å—å –ø–æ—Å–ª–µ —Å–±–æ—Ä–∫–∏
echo "üóëÔ∏è  –û—á–∏—Å—Ç–∫–∞ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö —Å–ª–æ–µ–≤ –∏ –æ–±—Ä–∞–∑–æ–≤..."
docker image prune -f

echo "-------------------------------------------------------"
echo "‚úÖ DEV-–≤–µ—Ä—Å–∏—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∞!"
echo "üîó –ê–¥—Ä–µ—Å: https://dev.breakout-ball.mooo.com:444/"
echo "-------------------------------------------------------"